# 📁 Flomo快速记录 - 项目结构

## 目录结构

```
flomo-quick-note/
│
├── 📄 main.py                    # 程序主入口，系统托盘和应用初始化
├── 📄 config.py                  # 配置管理模块，处理JSON配置文件
├── 📄 flomo_api.py              # Flomo API封装，负责网络请求
├── 📄 hotkey_manager.py         # 全局热键管理器
├── 📄 main_window.py            # 主输入窗口UI
├── 📄 settings_window.py        # 设置窗口UI
│
├── 📄 requirements.txt          # Python依赖清单
├── 📄 config.json              # 用户配置文件（自动生成）
├── 📄 .gitignore               # Git忽略配置
│
├── 📄 run.bat                   # Windows启动脚本
├── 📄 build.py                  # 打包脚本（Python版）
├── 📄 build.bat                 # 打包脚本（批处理版）
│
├── 📄 README.md                 # 项目说明文档
├── 📄 启动说明.md               # 快速启动指南
├── 📄 使用指南.txt              # 详细使用说明
├── 📄 项目结构说明.md           # 本文件
│
└── 📁 resources/                # 资源文件夹
    └── icon.ico                 # 应用图标（可选）
```

## 核心模块说明

### 1. main.py - 主程序入口
**职责：**
- 初始化应用程序
- 创建系统托盘图标
- 管理主窗口和设置窗口
- 协调各模块工作

**关键类：**
- `FlomoQuickNote`: 主应用类，管理整个应用生命周期

### 2. config.py - 配置管理
**职责：**
- 读写JSON配置文件
- 提供配置项的get/set接口
- 管理默认配置

**配置项：**
- `flomo_api_url`: Flomo API地址
- `hotkey`: 全局快捷键
- `default_tags`: 默认标签
- `auto_hide`: 是否自动隐藏窗口
- `window_width/height`: 窗口尺寸

### 3. flomo_api.py - API封装
**职责：**
- 封装Flomo HTTP API
- 处理网络请求和错误
- 格式化笔记内容和标签

**核心方法：**
- `send_memo()`: 发送笔记
- `validate_api_url()`: 验证API地址

### 4. hotkey_manager.py - 热键管理
**职责：**
- 注册/注销全局快捷键
- 监听快捷键事件
- 验证快捷键格式

**技术：**
- 使用 `keyboard` 库实现全局热键监听

### 5. main_window.py - 主输入窗口
**职责：**
- 提供笔记输入界面
- 处理用户输入
- 调用API发送笔记

**UI组件：**
- 多行文本输入框
- 标签输入框
- 发送/取消按钮
- 无边框置顶窗口

### 6. settings_window.py - 设置窗口
**职责：**
- 提供配置管理界面
- API地址配置和测试
- 快捷键设置
- 默认标签配置

## 数据流

```
用户按快捷键
    ↓
hotkey_manager.py 监听到事件
    ↓
main.py 调用 show_main_window()
    ↓
main_window.py 显示并获取焦点
    ↓
用户输入内容和标签
    ↓
点击发送按钮
    ↓
main_window.py 调用 flomo_api.send_memo()
    ↓
flomo_api.py 格式化内容并发送HTTP请求
    ↓
接收响应并显示结果
    ↓
自动隐藏窗口（如果配置了auto_hide）
```

## 配置文件格式

**config.json**
```json
{
    "flomo_api_url": "https://flomoapp.com/iwh/xxxxx",
    "hotkey": "ctrl+alt+f",
    "default_tags": "灵感 想法",
    "window_width": 500,
    "window_height": 350,
    "auto_hide": true,
    "auto_start": false,
    "last_tags": ""
}
```

## 技术选型

| 技术 | 用途 | 原因 |
|------|------|------|
| Python 3.10+ | 开发语言 | 开发快速、生态丰富 |
| PyQt6 | GUI框架 | 跨平台、界面美观 |
| keyboard | 全局热键 | 简单易用、支持Windows |
| requests | HTTP请求 | 稳定可靠的网络库 |
| PyInstaller | 打包工具 | 打包成独立exe文件 |

## 开发依赖

安装所有依赖：
```bash
pip install -r requirements.txt
```

依赖列表：
- PyQt6 >= 6.6.1 - GUI框架
- requests >= 2.31.0 - HTTP库
- keyboard >= 0.13.5 - 全局热键
- Pillow >= 10.1.0 - 图片处理（预留）
- pynput >= 1.7.6 - 输入监听（备选）

## 打包说明

### 打包命令
```bash
python build.py
# 或
build.bat
```

### 打包后文件
```
dist/
└── FlomoQuickNote.exe  # 独立可执行文件
```

## 扩展功能计划

- [ ] 图片粘贴支持
- [ ] 历史记录查看
- [ ] 离线缓存
- [ ] 更多主题样式
- [ ] 快捷短语
- [ ] 语音输入

## 注意事项

1. **管理员权限**: 全局热键可能需要管理员权限
2. **网络连接**: 需要网络连接才能同步到Flomo
3. **API地址**: 必须先配置有效的API地址才能使用
4. **快捷键冲突**: 避免与其他软件的快捷键冲突

---

**最后更新**: 2025-11-30

